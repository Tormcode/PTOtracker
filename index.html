import React, { useState, useEffect } from 'react';

// Main App Component
const App = () => {
  // State to manage the currently logged-in user
  // null means no user is logged in
  const [loggedInUser, setLoggedInUser] = useState(null);
  // State to manage the current view/page (e.g., 'login', 'dashboard', 'request', 'my-requests', 'manager-dashboard')
  const [currentView, setCurrentView] = useState('login');
  // State to store all PTO requests (simulating a database/Excel sheet)
  const [ptoRequests, setPtoRequests] = useState([]);
  // State to store user data (simulating a database/Excel sheet)
  const [users, setUsers] = useState([
    {
      id: 'emp001',
      name: 'Alice Smith',
      email: 'alice@example.com',
      password: 'password123', // In a real app, this would be a hashed password
      ptoBalance: 20,
      sickBalance: 10,
      role: 'employee',
    },
    {
      id: 'emp002',
      name: 'Bob Johnson',
      email: 'bob@example.com',
      password: 'password123',
      ptoBalance: 15,
      sickBalance: 8,
      role: 'employee',
    },
    {
      id: 'mgr001',
      name: 'Carol White',
      email: 'carol@example.com',
      password: 'password123',
      ptoBalance: 25,
      sickBalance: 12,
      role: 'manager', // Example of a manager role
    },
  ]);

  // Function to handle user login
  const handleLogin = (email, password) => {
    const user = users.find(u => u.email === email && u.password === password);
    if (user) {
      setLoggedInUser(user);
      setCurrentView('dashboard'); // Redirect to dashboard on successful login
      return true; // Indicate successful login
    }
    return false; // Indicate failed login
  };

  // Function to handle user logout
  const handleLogout = () => {
    setLoggedInUser(null);
    setCurrentView('login'); // Redirect to login page on logout
  };

  // Function to handle submitting a new PTO request
  const handleRequestPto = (requestData) => {
    // Generate a unique ID for the request
    const newRequestId = `req${ptoRequests.length + 1}`;
    const newRequest = {
      id: newRequestId,
      userId: loggedInUser.id,
      userName: loggedInUser.name, // Store user name for display
      requestDate: new Date().toLocaleDateString(),
      status: 'Pending', // All new requests are pending by default
      managerNotes: '', // Initialize manager notes
      ...requestData,
    };
    setPtoRequests(prevRequests => [...prevRequests, newRequest]);
    // In a real application, you would send this to the backend,
    // and the backend would update the Excel sheet and potentially
    // deduct from the balance upon approval.
    setCurrentView('my-requests'); // Navigate to requests page after submission
  };

  // Function for managers to update the status of a PTO request
  const handleUpdateRequestStatus = (requestId, newStatus, managerNotes) => {
    setPtoRequests(prevRequests => {
      const updatedRequests = prevRequests.map(req => {
        if (req.id === requestId) {
          return { ...req, status: newStatus, managerNotes: managerNotes };
        }
        return req;
      });

      // If the request is approved, deduct from the employee's balance
      if (newStatus === 'Approved') {
        const approvedRequest = updatedRequests.find(req => req.id === requestId);
        if (approvedRequest) {
          setUsers(prevUsers => {
            return prevUsers.map(user => {
              if (user.id === approvedRequest.userId) {
                let updatedUser = { ...user };
                if (approvedRequest.type === 'PTO') {
                  updatedUser.ptoBalance -= approvedRequest.duration;
                } else if (approvedRequest.type === 'Sick') {
                  updatedUser.sickBalance -= approvedRequest.duration;
                }
                return updatedUser;
              }
              return user;
            });
          });
        }
      }
      return updatedRequests;
    });
  };

  // Function to navigate between views
  const navigateTo = (view) => {
    setCurrentView(view);
  };

  // Render the appropriate component based on the currentView state
  const renderView = () => {
    if (!loggedInUser) {
      return <LoginPage onLogin={handleLogin} />;
    }

    switch (currentView) {
      case 'dashboard':
        return (
          <DashboardPage
            user={loggedInUser}
            onNavigate={navigateTo}
            onLogout={handleLogout}
          />
        );
      case 'request-pto':
        return (
          <RequestPTOPage
            user={loggedInUser}
            onRequestPto={handleRequestPto}
            onNavigate={navigateTo}
          />
        );
      case 'my-requests':
        // Filter requests for the logged-in user
        const userRequests = ptoRequests.filter(req => req.userId === loggedInUser.id);
        return (
          <MyRequestsPage
            user={loggedInUser}
            requests={userRequests}
            onNavigate={navigateTo}
          />
        );
      case 'manager-dashboard':
        // Only managers can access this view
        if (loggedInUser.role === 'manager') {
          // Filter for pending requests or all requests if manager wants to see all
          const pendingRequests = ptoRequests.filter(req => req.status === 'Pending');
          return (
            <ManagerDashboardPage
              user={loggedInUser}
              requests={pendingRequests} // Managers see pending requests
              onUpdateRequestStatus={handleUpdateRequestStatus}
              onNavigate={navigateTo}
            />
          );
        } else {
          // If a non-manager tries to access, redirect to dashboard
          setCurrentView('dashboard');
          return (
            <DashboardPage
              user={loggedInUser}
              onNavigate={navigateTo}
              onLogout={handleLogout}
            />
          );
        }
      default:
        return <LoginPage onLogin={handleLogin} />;
    }
  };

  return (
    <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 font-sans">
      <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-md md:max-w-lg lg:max-w-xl">
        {renderView()}
      </div>
    </div>
  );
};

// Login Page Component
const LoginPage = ({ onLogin }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    setError(''); // Clear previous errors
    if (onLogin(email, password)) {
      // Login successful, App component handles navigation
    } else {
      setError('Invalid email or password.');
    }
  };

  return (
    <div className="text-center">
      <h2 className="text-3xl font-bold text-gray-800 mb-6">PTO Tracker Login</h2>
      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <input
            type="email"
            placeholder="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            required
          />
        </div>
        <div>
          <input
            type="password"
            placeholder="Password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            required
          />
        </div>
        {error && <p className="text-red-500 text-sm">{error}</p>}
        <button
          type="submit"
          className="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 transition duration-300 shadow-md"
        >
          Login
        </button>
      </form>
      <p className="mt-6 text-gray-600 text-sm">
        <span className="font-semibold">Test Accounts:</span>
        <br />
        Employee: alice@example.com / password123
        <br />
        Employee: bob@example.com / password123
        <br />
        Manager: carol@example.com / password123
      </p>
    </div>
  );
};

// Dashboard Page Component
const DashboardPage = ({ user, onNavigate, onLogout }) => {
  return (
    <div className="text-center">
      <h2 className="text-3xl font-bold text-gray-800 mb-6">Welcome, {user.name}!</h2>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div className="bg-blue-50 p-6 rounded-lg shadow-sm">
          <h3 className="text-xl font-semibold text-blue-800">PTO Balance</h3>
          <p className="text-4xl font-extrabold text-blue-600 mt-2">{user.ptoBalance} days</p>
        </div>
        <div className="bg-green-50 p-6 rounded-lg shadow-sm">
          <h3 className="text-xl font-semibold text-green-800">Sick Balance</h3>
          <p className="text-4xl font-extrabold text-green-600 mt-2">{user.sickBalance} days</p>
        </div>
      </div>
      <div className="space-y-4">
        <button
          onClick={() => onNavigate('request-pto')}
          className="w-full bg-purple-600 text-white p-3 rounded-md hover:bg-purple-700 transition duration-300 shadow-md"
        >
          Request PTO
        </button>
        <button
          onClick={() => onNavigate('my-requests')}
          className="w-full bg-indigo-600 text-white p-3 rounded-md hover:bg-indigo-700 transition duration-300 shadow-md"
        >
          View My Requests
        </button>
        {user.role === 'manager' && (
          <button
            onClick={() => onNavigate('manager-dashboard')}
            className="w-full bg-orange-600 text-white p-3 rounded-md hover:bg-orange-700 transition duration-300 shadow-md"
          >
            Manage PTO Requests
          </button>
        )}
        <button
          onClick={onLogout}
          className="w-full bg-gray-300 text-gray-800 p-3 rounded-md hover:bg-gray-400 transition duration-300 shadow-md"
        >
          Logout
        </button>
      </div>
    </div>
  );
};

// Request PTO Page Component
const RequestPTOPage = ({ user, onRequestPto, onNavigate }) => {
  const [startDate, setStartDate] = useState('');
  const [endDate, setEndDate] = useState('');
  const [leaveType, setLeaveType] = useState('PTO');
  const [comments, setComments] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    setError('');

    if (!startDate || !endDate) {
      setError('Please select both start and end dates.');
      return;
    }

    const start = new Date(startDate);
    const end = new Date(endDate);

    if (start > end) {
      setError('End date cannot be before start date.');
      return;
    }

    // Calculate duration (simple day count, not accounting for weekends/holidays for prototype)
    const diffTime = Math.abs(end - start);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 to include start day

    // Basic balance check (for prototype, no actual deduction here, just a warning)
    if (leaveType === 'PTO' && diffDays > user.ptoBalance) {
      setError(`You only have ${user.ptoBalance} PTO days remaining. This request exceeds your balance.`);
      // Allow submission for prototype, but in a real app, you might prevent it or flag it.
    }
    if (leaveType === 'Sick' && diffDays > user.sickBalance) {
      setError(`You only have ${user.sickBalance} Sick days remaining. This request exceeds your balance.`);
      // Allow submission for prototype
    }

    onRequestPto({
      startDate,
      endDate,
      type: leaveType,
      duration: diffDays,
      comments,
    });
    // Clear form fields after submission
    setStartDate('');
    setEndDate('');
    setLeaveType('PTO');
    setComments('');
  };

  return (
    <div className="text-center">
      <h2 className="text-3xl font-bold text-gray-800 mb-6">Request Time Off</h2>
      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label htmlFor="startDate" className="block text-left text-gray-700 text-sm font-medium mb-1">Start Date</label>
          <input
            type="date"
            id="startDate"
            value={startDate}
            onChange={(e) => setStartDate(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            required
          />
        </div>
        <div>
          <label htmlFor="endDate" className="block text-left text-gray-700 text-sm font-medium mb-1">End Date</label>
          <input
            type="date"
            id="endDate"
            value={endDate}
            onChange={(e) => setEndDate(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            required
          />
        </div>
        <div>
          <label htmlFor="leaveType" className="block text-left text-gray-700 text-sm font-medium mb-1">Type of Leave</label>
          <select
            id="leaveType"
            value={leaveType}
            onChange={(e) => setLeaveType(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="PTO">Paid Time Off (PTO)</option>
            <option value="Sick">Sick Leave</option>
            <option value="Unpaid">Unpaid Leave</option>
          </select>
        </div>
        <div>
          <label htmlFor="comments" className="block text-left text-gray-700 text-sm font-medium mb-1">Comments (Optional)</label>
          <textarea
            id="comments"
            value={comments}
            onChange={(e) => setComments(e.target.value)}
            rows="3"
            className="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
          ></textarea>
        </div>
        {error && <p className="text-red-500 text-sm">{error}</p>}
        <button
          type="submit"
          className="w-full bg-green-600 text-white p-3 rounded-md hover:bg-green-700 transition duration-300 shadow-md"
        >
          Submit Request
        </button>
        <button
          type="button"
          onClick={() => onNavigate('dashboard')}
          className="w-full bg-gray-300 text-gray-800 p-3 rounded-md hover:bg-gray-400 transition duration-300 shadow-md"
        >
          Back to Dashboard
        </button>
      </form>
    </div>
  );
};

// My Requests Page Component
const MyRequestsPage = ({ user, requests, onNavigate }) => {
  return (
    <div className="text-center">
      <h2 className="text-3xl font-bold text-gray-800 mb-6">My PTO Requests</h2>
      {requests.length === 0 ? (
        <p className="text-gray-600">You have no submitted PTO requests yet.</p>
      ) : (
        <div className="overflow-x-auto">
          <table className="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Request Date</th>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration (Days)</th>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Manager Notes</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {requests.map((req) => (
                <tr key={req.id}>
                  <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{req.requestDate}</td>
                  <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{req.startDate}</td>
                  <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{req.endDate}</td>
                  <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{req.type}</td>
                  <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{req.duration}</td>
                  <td className="px-4 py-3 whitespace-nowrap text-sm">
                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                      ${req.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :
                        req.status === 'Approved' ? 'bg-green-100 text-green-800' :
                        'bg-red-100 text-red-800'}`}>
                      {req.status}
                    </span>
                  </td>
                  <td className="px-4 py-3 text-sm text-gray-900 max-w-xs overflow-hidden text-ellipsis">{req.managerNotes || '-'}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
      <button
        onClick={() => onNavigate('dashboard')}
        className="mt-6 w-full bg-gray-300 text-gray-800 p-3 rounded-md hover:bg-gray-400 transition duration-300 shadow-md"
      >
        Back to Dashboard
      </button>
    </div>
  );
};

// Modal Component for displaying generated content (email/summary)
const ContentModal = ({ title, content, onClose, onCopy }) => {
  return (
    <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
      <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
        <h3 className="text-2xl font-bold text-gray-800 mb-4">{title}</h3>
        <textarea
          readOnly
          value={content}
          className="w-full h-48 p-3 border border-gray-300 rounded-md bg-gray-50 resize-none text-sm"
        ></textarea>
        <div className="mt-4 flex justify-end space-x-2">
          <button
            onClick={onCopy}
            className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300"
          >
            Copy to Clipboard
          </button>
          <button
            onClick={onClose}
            className="bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 transition duration-300"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};


// Manager Dashboard Page Component
const ManagerDashboardPage = ({ user, requests, onUpdateRequestStatus, onNavigate }) => {
  const [selectedRequestId, setSelectedRequestId] = useState(null);
  const [managerNotes, setManagerNotes] = useState('');
  const [actionType, setActionType] = useState(''); // 'approve' or 'deny'
  const [draftedEmail, setDraftedEmail] = useState('');
  const [showEmailModal, setShowEmailModal] = useState(false);
  const [summaryContent, setSummaryContent] = useState('');
  const [showSummaryModal, setShowSummaryModal] = useState(false);
  const [isLoading, setIsLoading] = useState(false); // For loading state

  // Function to open the modal/inline form for action
  const openActionForm = (requestId, type) => {
    setSelectedRequestId(requestId);
    setActionType(type);
    setManagerNotes(''); // Clear notes for new action
  };

  // Function to handle the approval/denial submission
  const handleSubmitAction = () => {
    if (selectedRequestId) {
      onUpdateRequestStatus(selectedRequestId, actionType === 'approve' ? 'Approved' : 'Denied', managerNotes);
      setSelectedRequestId(null); // Close the form/modal
      setManagerNotes('');
      setActionType('');
    }
  };

  // Function to draft an email using Gemini API
  const handleDraftEmail = async (request) => {
    setIsLoading(true);
    const status = actionType === 'approve' ? 'Approved' : 'Denied';
    const prompt = `Draft a professional email to an employee regarding their PTO request.
    Employee Name: ${request.userName}
    Request Type: ${request.type}
    Start Date: ${request.startDate}
    End Date: ${request.endDate}
    Duration: ${request.duration} days
    Status: ${status}
    Manager Notes: ${managerNotes || 'No specific notes.'}

    Please ensure the email is concise, polite, and clearly states the outcome of the request.
    `;

    try {
      let chatHistory = [];
      chatHistory.push({ role: "user", parts: [{ text: prompt }] });
      const payload = { contents: chatHistory };
      const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const result = await response.json();

      if (result.candidates && result.candidates.length > 0 &&
          result.candidates[0].content && result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0) {
        setDraftedEmail(result.candidates[0].content.parts[0].text);
        setShowEmailModal(true);
      } else {
        setDraftedEmail('Failed to draft email. Please try again.');
        setShowEmailModal(true);
      }
    } catch (error) {
      console.error('Error drafting email:', error);
      setDraftedEmail('An error occurred while drafting the email.');
      setShowEmailModal(true);
    } finally {
      setIsLoading(false);
    }
  };

  // Function to summarize pending requests using Gemini API
  const handleSummarizeRequests = async () => {
    setIsLoading(true);
    const pendingRequestsDetails = pendingRequests.map(req =>
      `${req.userName} requested ${req.duration} ${req.type} days from ${req.startDate} to ${req.endDate}. Comments: "${req.comments || 'N/A'}"`
    ).join('\n');

    const prompt = `Summarize the following pending PTO/Sick leave requests for a manager.
    Highlight the total number of requests, the total days requested, and any common patterns or urgent requests if identifiable.

    Pending Requests:
    ${pendingRequestsDetails || 'No pending requests.'}
    `;

    try {
      let chatHistory = [];
      chatHistory.push({ role: "user", parts: [{ text: prompt }] });
      const payload = { contents: chatHistory };
      const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const result = await response.json();

      if (result.candidates && result.candidates.length > 0 &&
          result.candidates[0].content && result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0) {
        setSummaryContent(result.candidates[0].content.parts[0].text);
        setShowSummaryModal(true);
      } else {
        setSummaryContent('Failed to generate summary. Please try again.');
        setShowSummaryModal(true);
      }
    } catch (error) {
      console.error('Error summarizing requests:', error);
      setSummaryContent('An error occurred while summarizing requests.');
      setShowSummaryModal(true);
    } finally {
      setIsLoading(false);
    }
  };

  const copyToClipboard = (text) => {
    document.execCommand('copy'); // Fallback for navigator.clipboard
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    try {
      document.execCommand('copy');
      alert('Copied to clipboard!'); // Using alert for simplicity in prototype
    } catch (err) {
      console.error('Failed to copy text: ', err);
      alert('Failed to copy to clipboard. Please copy manually.');
    }
    document.body.removeChild(textarea);
  };

  // Filter requests that are still pending for the manager to act on
  const pendingRequests = requests.filter(req => req.status === 'Pending');
  const selectedRequest = selectedRequestId ? requests.find(req => req.id === selectedRequestId) : null;

  return (
    <div className="text-center">
      <h2 className="text-3xl font-bold text-gray-800 mb-6">Manager Dashboard - Pending Requests</h2>

      <button
        onClick={handleSummarizeRequests}
        className="w-full bg-blue-500 text-white p-3 rounded-md hover:bg-blue-600 transition duration-300 shadow-md mb-6 flex items-center justify-center"
        disabled={isLoading}
      >
        {isLoading ? (
          <svg className="animate-spin h-5 w-5 mr-3 text-white" viewBox="0 0 24 24">
            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        ) : (
          '✨ Summarize Pending Requests'
        )}
      </button>

      {pendingRequests.length === 0 ? (
        <p className="text-gray-600">No pending PTO requests at this time.</p>
      ) : (
        <div className="space-y-4">
          {pendingRequests.map((req) => (
            <div key={req.id} className="bg-gray-50 p-4 rounded-lg shadow-sm text-left border border-gray-200">
              <p className="text-lg font-semibold text-gray-800">{req.userName} - {req.type} Request</p>
              <p className="text-sm text-gray-600">Dates: {req.startDate} to {req.endDate} ({req.duration} days)</p>
              <p className="text-sm text-gray-600">Submitted: {req.requestDate}</p>
              {req.comments && <p className="text-sm text-gray-700 italic">Comments: "{req.comments}"</p>}

              <div className="mt-3 flex space-x-2">
                <button
                  onClick={() => openActionForm(req.id, 'approve')}
                  className="flex-1 bg-green-500 text-white px-3 py-2 rounded-md hover:bg-green-600 transition duration-300 text-sm"
                >
                  Approve
                </button>
                <button
                  onClick={() => openActionForm(req.id, 'deny')}
                  className="flex-1 bg-red-500 text-white px-3 py-2 rounded-md hover:bg-red-600 transition duration-300 text-sm"
                >
                  Deny
                </button>
              </div>

              {selectedRequestId === req.id && (
                <div className="mt-4 p-3 bg-white rounded-md border border-gray-200">
                  <h4 className="font-semibold mb-2">Add Manager Notes ({actionType === 'approve' ? 'Approving' : 'Denying'})</h4>
                  <textarea
                    value={managerNotes}
                    onChange={(e) => setManagerNotes(e.target.value)}
                    rows="2"
                    placeholder="Enter notes here..."
                    className="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm"
                  ></textarea>
                  <div className="mt-2 flex justify-end space-x-2">
                    <button
                      onClick={handleSubmitAction}
                      className={`px-4 py-2 rounded-md text-white text-sm ${actionType === 'approve' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}
                    >
                      Confirm {actionType === 'approve' ? 'Approval' : 'Denial'}
                    </button>
                    <button
                      type="button"
                      onClick={() => handleDraftEmail(selectedRequest)}
                      className="px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700 transition duration-300 text-sm flex items-center justify-center"
                      disabled={isLoading}
                    >
                      {isLoading ? (
                        <svg className="animate-spin h-4 w-4 mr-2 text-white" viewBox="0 0 24 24">
                          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                      ) : (
                        '✨ Draft Email'
                      )}
                    </button>
                    <button
                      onClick={() => setSelectedRequestId(null)}
                      className="px-4 py-2 rounded-md bg-gray-300 text-gray-800 hover:bg-gray-400 text-sm"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      )}
      <button
        onClick={() => onNavigate('dashboard')}
        className="mt-6 w-full bg-gray-300 text-gray-800 p-3 rounded-md hover:bg-gray-400 transition duration-300 shadow-md"
      >
        Back to Dashboard
      </button>

      {showEmailModal && (
        <ContentModal
          title="Drafted Email"
          content={draftedEmail}
          onClose={() => setShowEmailModal(false)}
          onCopy={() => copyToClipboard(draftedEmail)}
        />
      )}

      {showSummaryModal && (
        <ContentModal
          title="Pending Requests Summary"
          content={summaryContent}
          onClose={() => setShowSummaryModal(false)}
          onCopy={() => copyToClipboard(summaryContent)}
        />
      )}
    </div>
  );
};

export default App;
